<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>DI-Agent SDK ¬∑ –î–∞—à–±–æ—Ä–¥ –ø–æ–∏—Å–∫–∞ –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤</title>
  <style>
    :root{
      --bg:#0e0f13;--panel:#131722;--panel2:#0f1320;--text:#e8eefc;--muted:#a9b4c7;
      --pri:#58a6ff;--pri-2:#2b6bb3;--ok:#19c37d;--warn:#ffcc00;--err:#ff5c5c;--chip:#1a2140;
      --card:#0f1424;--border:#1e2740;--code:#0b1020;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;background:linear-gradient(180deg,#0b0d14 0%,#0e0f13 30%,#0a0c15 100%);
      color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
    }
    .wrap{max-width:1100px;margin:32px auto;padding:0 16px}
    .header{
      display:flex;gap:14px;align-items:center;justify-content:space-between;margin-bottom:18px
    }
    .brand{display:flex;gap:12px;align-items:center}
    .logo{
      width:38px;height:38px;border-radius:10px;background:radial-gradient(circle at 30% 20%,#6ac8ff,transparent 60%),
      radial-gradient(circle at 80% 70%,#3cf,transparent 55%),linear-gradient(135deg,#0e1a3a,#1a2a5c);
      box-shadow:0 6px 18px rgba(88,166,255,.25), inset 0 0 0 1px #2a3a70;
    }
    h1{font-size:18px;margin:0}
    .ver{color:var(--muted);font-size:12px;border:1px solid var(--border);padding:2px 8px;border-radius:999px}
    .toolbar{
      display:flex;flex-wrap:wrap;gap:10px;background:var(--panel);padding:12px;border:1px solid var(--border);
      border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.35)
    }
    .input{
      flex:1;min-width:260px;display:flex;align-items:center;gap:8px;background:var(--panel2);
      border:1px solid var(--border);border-radius:10px;padding:10px 12px
    }
    .input input{
      background:transparent;border:0;outline:none;color:var(--text);width:100%;font-size:15px
    }
    .btn{
      background:var(--pri);border:1px solid #2a5ea3;color:#fff;padding:10px 14px;border-radius:10px;
      cursor:pointer;font-weight:600;transition:.12s ease;user-select:none
    }
    .btn:disabled{opacity:.5;cursor:not-allowed}
    .btn:hover{transform:translateY(-1px);box-shadow:0 6px 14px rgba(88,166,255,.25)}
    .btn.sec{background:#1b2340;border-color:#2a3560}
    .btn.ghost{background:transparent;border-color:var(--border);color:var(--muted)}
    .chips{display:flex;gap:8px;flex-wrap:wrap}
    .chip{background:var(--chip);border:1px solid var(--border);color:#b9c6e3;padding:6px 10px;border-radius:999px;font-size:12px;cursor:pointer}
    .chip.sel{outline:2px solid #2454a6;color:#d9e7ff}
    .grid{
      display:grid;grid-template-columns:repeat(12,1fr);gap:14px;margin-top:16px
    }
    .col-8{grid-column:span 8}
    .col-4{grid-column:span 4}
    @media(max-width:980px){.col-8,.col-4{grid-column:span 12}}
    .card{
      background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px;
      box-shadow:0 12px 24px rgba(0,0,0,.35)
    }
    .stat{display:flex;gap:10px;align-items:center;color:var(--muted);font-size:13px}
    .results{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:12px;margin-top:10px}
    .supplier{
      background:linear-gradient(180deg,#0f1426,#0b1122);border:1px solid var(--border);border-radius:12px;padding:12px;display:flex;flex-direction:column;gap:8px
    }
    .supplier h3{margin:0;font-size:15px;color:#e6efff}
    .line{display:flex;gap:8px;align-items:center;color:#b9c6e3;font-size:13px;flex-wrap:wrap}
    .tag{background:#0c1533;border:1px solid #22315a;border-radius:6px;padding:2px 6px}
    .link{color:#7ec0ff;text-decoration:none}
    .empty,.error{padding:16px;border-radius:12px;border:1px dashed var(--border);background:#0b1020aa;color:#b9c6e3}
    .ok{color:var(--ok)} .warn{color:var(--warn)} .err{color:var(--err)}
    .foot{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .mono{font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;background:var(--code);border:1px solid var(--border);
      color:#cfe2ff;border-radius:8px;padding:10px;overflow:auto;font-size:12px}
    .row{display:flex;gap:8px;align-items:center;justify-content:space-between}
    .mut{color:var(--muted)}
    .badge{border:1px solid var(--border);border-radius:8px;padding:8px 10px;background:#0c1224;display:flex;gap:6px;align-items:center}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <div class="brand">
        <div class="logo"></div>
        <div>
          <h1>DI-Agent SDK ‚Äî –ü–æ–∏—Å–∫ –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤</h1>
          <div class="mut">–ú–∏–Ω–∏-–ø–∞–Ω–µ–ª—å –¥–ª—è —Ç–≤–æ–µ–≥–æ API. –í—Å—Ç–∞–≤—å –∑–∞–ø—Ä–æ—Å ‚Üí –ø–æ–ª—É—á–∏ –∫–∞—Ä—Ç–æ—á–∫–∏.</div>
        </div>
      </div>
      <div class="ver">v1.0 ¬∑ frontend</div>
    </div>

    <div class="toolbar">
      <div class="input" style="flex:1.4">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="#8fb8ff"><path d="M21 21l-4.3-4.3M10 18a8 8 0 1 1 0-16 8 8 0 0 1 0 16Z"/></svg>
        <input id="q" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: LGS/LSTK profiles G550 AZ150, fiber-cement panels, steel coils‚Ä¶" />
      </div>
      <button id="btnSearch" class="btn" onclick="runSearch()">–ò—Å–∫–∞—Ç—å</button>
      <button class="btn sec" onclick="exportJSON()">–≠–∫—Å–ø–æ—Ä—Ç JSON</button>
      <button class="btn ghost" onclick="openSettings()">API</button>
    </div>

    <div class="chips" style="margin-top:10px">
      <div class="chip sel" data-src="all" onclick="toggleSource(this)">All</div>
      <div class="chip" data-src="Alibaba" onclick="toggleSource(this)">Alibaba</div>
      <div class="chip" data-src="Made-in-China" onclick="toggleSource(this)">Made-in-China</div>
      <div class="chip" data-src="GlobalSources" onclick="toggleSource(this)">GlobalSources</div>
      <div class="chip" data-src="1688" onclick="toggleSource(this)">1688</div>
    </div>

    <div class="grid">
      <div class="col-8">
        <div id="status" class="stat">
          <span class="badge"><span class="ok">‚óè</span> –ì–æ—Ç–æ–≤–æ</span>
          <span class="mut">–ë–∞–∑–∞ API: <span id="baseShow" class="link"></span></span>
        </div>

        <div id="cards" class="results" style="min-height:80px;margin-top:12px"></div>
        <div id="empty" class="empty" style="display:none">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö. –ü–æ–ø—Ä–æ–±—É–π –¥—Ä—É–≥–æ–π –∑–∞–ø—Ä–æ—Å –∏–ª–∏ –¥—Ä—É–≥–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫.</div>
        <div id="error" class="error" style="display:none">–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è. –ü—Ä–æ–≤–µ—Ä—å –¥–æ–º–µ–Ω API –∏–ª–∏ —Å–µ—Ç—å.</div>
      </div>

      <div class="col-4">
        <div class="card">
          <div class="row">
            <strong>–ö–æ–Ω—Å–æ–ª—å</strong>
            <span class="mut" id="count">0 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</span>
          </div>
          <div id="log" class="mono" style="height:220px"></div>
          <div class="foot">
            <button class="btn ghost" onclick="clearLog()">–û—á–∏—Å—Ç–∏—Ç—å</button>
            <button class="btn ghost" onclick="quick('–õ–°–¢–ö –ø—Ä–æ—Ñ–∏–ª–∏ G550 AZ150')">–ü—Ä–∏–º–µ—Ä LSTK</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ API -->
  <dialog id="dlg" style="border:none;border-radius:12px;padding:0;max-width:520px;width:92%">
    <form method="dialog" style="background:var(--panel);border:1px solid var(--border);border-radius:12px;overflow:hidden">
      <div style="padding:14px 14px 0"><strong>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ API</strong></div>
      <div style="padding:14px;display:flex;gap:10px;flex-direction:column">
        <div class="input">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="#8fb8ff"><path d="M4 7h16M4 12h16M4 17h16"/></svg>
          <input id="apiBase" placeholder="https://di-agent-sdk.onrender.com" />
        </div>
        <div class="mut">–¢—É—Ç –∫–æ—Ä–µ–Ω—å —Ç–≤–æ–µ–≥–æ –±—ç–∫–µ–Ω–¥–∞ FastAPI. –û—Å—Ç–∞–≤—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –µ—Å–ª–∏ —É–∂–µ –∑–∞–¥–µ–ø–ª–æ–µ–Ω–æ –Ω–∞ Render.</div>
      </div>
      <div style="padding:12px;border-top:1px solid var(--border);display:flex;gap:8px;justify-content:flex-end;background:#0f1423">
        <button class="btn ghost" value="cancel">–û—Ç–º–µ–Ω–∞</button>
        <button class="btn" value="ok" onclick="saveSettings()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      </div>
    </form>
  </dialog>

  <script>
    // ---- –ë–ê–ó–û–í–´–ï –ù–ê–°–¢–†–û–ô–ö–ò ----
    const API_BASE = localStorage.getItem('apiBase') || 'https://di-agent-sdk.onrender.com';
    document.getElementById('apiBase')?.setAttribute('value', API_BASE);
    document.getElementById('baseShow').textContent = API_BASE;

    const qEl = document.getElementById('q');
    const cardsEl = document.getElementById('cards');
    const logEl = document.getElementById('log');
    const emptyEl = document.getElementById('empty');
    const errEl = document.getElementById('error');
    const countEl = document.getElementById('count');

    let lastData = [];
    let sourceFilter = 'all';

    qEl.addEventListener('keydown', (e)=>{ if(e.key==='Enter') runSearch(); });

    function openSettings(){ document.getElementById('dlg').showModal(); }
    function saveSettings(){
      const v = document.getElementById('apiBase').value.trim();
      if(v){ localStorage.setItem('apiBase', v); location.reload(); }
    }

    function quick(txt){ qEl.value = txt; runSearch(); }

    function toggleSource(el){
      document.querySelectorAll('.chip').forEach(c=>c.classList.remove('sel'));
      el.classList.add('sel');
      sourceFilter = el.dataset.src;
      renderCards(lastData);
    }

    async function runSearch(){
      const q = qEl.value.trim();
      if(!q){ qEl.focus(); return; }

      setBusy(true);
      emptyEl.style.display = 'none'; errEl.style.display = 'none'; cardsEl.innerHTML = '';

      log(`–ó–∞–ø—Ä–æ—Å: ${q}`);

      try{
        const url = `${(localStorage.getItem('apiBase')||API_BASE).replace(/\/$/,'')}/search?q=${encodeURIComponent(q)}`;
        const res = await fetch(url, {headers:{'Accept':'application/json'}});
        const data = await res.json();

        if(!data || !Array.isArray(data.results) || data.results.length===0){
          lastData = [];
          countEl.textContent = '0 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤';
          emptyEl.style.display = 'block';
          return;
        }

        lastData = data.results;
        renderCards(lastData);
        countEl.textContent = `${lastData.length} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤`;
      }catch(err){
        console.error(err);
        errEl.style.display = 'block';
        log('–û—à–∏–±–∫–∞: ' + (err.message || err));
      }finally{
        setBusy(false);
      }
    }

    function renderCards(items){
      const filtered = sourceFilter==='all' ? items : items.filter(x=> (x.–ò—Å—Ç–æ—á–Ω–∏–∫||x.source||'').includes(sourceFilter));
      cardsEl.innerHTML = filtered.map(toCard).join('') || '<div class="empty">–§–∏–ª—å—Ç—Ä –Ω–∏—á–µ–≥–æ –Ω–µ –¥–∞–ª.</div>';
    }

    function toCard(x){
      const title = esc(x.–ù–∞–∑–≤–∞–Ω–∏–µ || x.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è');
      const link = x.–°—Å—ã–ª–∫–∞ || x.link || '';
      const src  = x.–ò—Å—Ç–æ—á–Ω–∏–∫ || x.source || '';
      const region = x.Region || x.region || '';
      const prod = x.–ü—Ä–æ–¥—É–∫—Ç || x.product || '';
      const moq = x.MOQ || x.moq || '';
      const price = x.–¶–µ–Ω–∞ || x.price || '';
      const cert = x.–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã || x.certificates || '';

      return `
        <div class="supplier">
          <h3>${title}</h3>
          <div class="line">
            ${region?`<span class="tag">üåç ${esc(region)}</span>`:''}
            ${prod?`<span class="tag">üè∑Ô∏è ${esc(prod)}</span>`:''}
            ${moq?`<span class="tag">üì¶ MOQ: ${esc(moq)}</span>`:''}
            ${price?`<span class="tag">üí∞ ${esc(price)}</span>`:''}
          </div>
          ${cert?`<div class="line">üßæ ${esc(cert)}</div>`:''}
          <div class="line">
            ${link?`<a class="link" href="${sanitizeUrl(link)}" target="_blank" rel="noopener">–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É ‚Üí</a>`:`<span class="mut">–°—Å—ã–ª–∫–∏ –Ω–µ—Ç</span>`}
            <span class="mut">–ò—Å—Ç–æ—á–Ω–∏–∫: ${esc(src)}</span>
          </div>
        </div>
      `;
    }

    function exportJSON(){
      const blob = new Blob([JSON.stringify(lastData, null, 2)], {type:'application/json'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = `di-agent-results-${Date.now()}.json`;
      a.click();
      URL.revokeObjectURL(a.href);
    }

    function setBusy(b){
      const btn = document.getElementById('btnSearch');
      btn.disabled = b;
      btn.textContent = b ? '–ü–æ–∏—Å–∫‚Ä¶' : '–ò—Å–∫–∞—Ç—å';
    }

    function log(s){
      const t = `[${new Date().toLocaleTimeString()}] ${s}\n`;
      logEl.textContent = t + logEl.textContent;
    }
    function clearLog(){ logEl.textContent=''; }

    // –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
    function esc(s){ return String(s).replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m])); }
    function sanitizeUrl(u){
      try{
        const x = new URL(u, 'https://x.invalid'); // –ø–æ–∑–≤–æ–ª–∏—Ç –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ
        if(/^https?:$/i.test(x.protocol) || u.startsWith('/')) return u;
        return '#';
      }catch{ return '#'; }
    }

    // –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
    log('–ì–æ—Ç–æ–≤–æ. –í–≤–µ–¥–∏ –∑–∞–ø—Ä–æ—Å –∏ –∂–º–∏ ¬´–ò—Å–∫–∞—Ç—å¬ª.');
  </script>
</body>
</html>