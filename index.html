<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>DI-Agent SDK · Дашборд поиска поставщиков</title>
  <style>
    :root{
      --bg:#0e0f13;--panel:#131722;--panel2:#0f1320;--text:#e8eefc;--muted:#a9b4c7;
      --pri:#58a6ff;--pri-2:#2b6bb3;--ok:#19c37d;--warn:#ffcc00;--err:#ff5c5c;--chip:#1a2140;
      --card:#0f1424;--border:#1e2740;--code:#0b1020;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;background:linear-gradient(180deg,#0b0d14 0%,#0e0f13 30%,#0a0c15 100%);
      color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
    }
    .wrap{max-width:1100px;margin:32px auto;padding:0 16px}
    .header{display:flex;gap:14px;align-items:center;justify-content:space-between;margin-bottom:18px}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{
      width:38px;height:38px;border-radius:10px;background:radial-gradient(circle at 30% 20%,#6ac8ff,transparent 60%),
      radial-gradient(circle at 80% 70%,#3cf,transparent 55%),linear-gradient(135deg,#0e1a3a,#1a2a5c);
      box-shadow:0 6px 18px rgba(88,166,255,.25), inset 0 0 0 1px #2a3a70;
    }
    h1{font-size:18px;margin:0}
    .ver{color:var(--muted);font-size:12px;border:1px solid var(--border);padding:2px 8px;border-radius:999px}
    .toolbar{
      display:flex;flex-wrap:wrap;gap:10px;background:var(--panel);padding:12px;border:1px solid var(--border);
      border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.35)
    }
    .input{
      flex:1;min-width:260px;display:flex;align-items:center;gap:8px;background:var(--panel2);
      border:1px solid var(--border);border-radius:10px;padding:10px 12px
    }
    .input input{
      background:transparent;border:0;outline:none;color:var(--text);width:100%;font-size:15px
    }
    .btn{
      background:var(--pri);border:1px solid #2a5ea3;color:#fff;padding:10px 14px;border-radius:10px;
      cursor:pointer;font-weight:600;transition:.12s ease;user-select:none
    }
    .btn:disabled{opacity:.5;cursor:not-allowed}
    .btn:hover{transform:translateY(-1px);box-shadow:0 6px 14px rgba(88,166,255,.25)}
    .btn.sec{background:#1b2340;border-color:#2a3560}
    .btn.ghost{background:transparent;border-color:var(--border);color:var(--muted)}
    iframe{
      width:100%;height:75vh;border:none;border-radius:12px;background:#0b1020;margin-top:18px;
      box-shadow:0 10px 30px rgba(0,0,0,.35)
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <div class="brand">
        <div class="logo"></div>
        <div>
          <h1>DI-Agent SDK — Поиск поставщиков</h1>
          <div class="mut">Вставь запрос → получи HTML-карточки от FastAPI SDK.</div>
        </div>
      </div>
      <div class="ver">v2.0 SDK</div>
    </div>

    <div class="toolbar">
      <div class="input" style="flex:1.4">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="#8fb8ff"><path d="M21 21l-4.3-4.3M10 18a8 8 0 1 1 0-16 8 8 0 0 1 0 16Z"/></svg>
        <input id="q" placeholder="Например: light steel frame G550, пенобетон D600, фиброцементные панели…" />
      </div>
      <button id="btnSearch" class="btn" onclick="runSearch()">Искать</button>
      <button class="btn sec" onclick="openSettings()">API</button>
    </div>

    <iframe id="frame" src=""></iframe>
  </div>

  <!-- Настройки -->
  <dialog id="dlg" style="border:none;border-radius:12px;padding:0;max-width:520px;width:92%">
    <form method="dialog" style="background:var(--panel);border:1px solid var(--border);border-radius:12px;overflow:hidden">
      <div style="padding:14px 14px 0"><strong>Настройки API</strong></div>
      <div style="padding:14px;display:flex;gap:10px;flex-direction:column">
        <div class="input">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="#8fb8ff"><path d="M4 7h16M4 12h16M4 17h16"/></svg>
          <input id="apiBase" placeholder="https://di-agent-sdk.onrender.com" />
        </div>
        <div class="mut">Корневой адрес твоего SDK-сервера (Render FastAPI).</div>
      </div>
      <div style="padding:12px;border-top:1px solid var(--border);display:flex;gap:8px;justify-content:flex-end;background:#0f1423">
        <button class="btn ghost" value="cancel">Отмена</button>
        <button class="btn" value="ok" onclick="saveSettings()">Сохранить</button>
      </div>
    </form>
  </dialog>

  <script>
    const API_BASE = localStorage.getItem('apiBase') || 'https://di-agent-sdk.onrender.com';
    document.getElementById('apiBase')?.setAttribute('value', API_BASE);
    const qEl = document.getElementById('q');
    const frame = document.getElementById('frame');

    qEl.addEventListener('keydown', e => { if(e.key === 'Enter') runSearch(); });
    function openSettings(){ document.getElementById('dlg').showModal(); }
    function saveSettings(){
      const v = document.getElementById('apiBase').value.trim();
      if(v){ localStorage.setItem('apiBase', v); location.reload(); }
    }

    function runSearch(){
      const q = qEl.value.trim();
      if(!q){ qEl.focus(); return; }
      const base = (localStorage.getItem('apiBase')||API_BASE).replace(/\/$/,'');
      // теперь подключено к SDK: вызываем HTML-версию с карточками
      frame.src = `${base}/search_all_html?q=${encodeURIComponent(q)}`;
    }

    // приветственная страница
    frame.src = `${API_BASE}/`;
  </script>
</body>
</html>